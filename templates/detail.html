{% extends "header.html" %}
{% set images = gun.get_images() %}
{% block main_content %}

 <form action="/set_entry" id="bronze" method="post">
    <input type="hidden" id="id" name="id" value="{{ gun.gunid }}" readonly >
    <input type="hidden" id="user_id" name="user_id" value="{{gun.user_id}}" readonly >
    <div class="row p-3  bg-ur" >
            <div class="media">
                <a class="align-self-center mr-3 fancybox" href="{{images[0].original}}"><img src="{{images[0].s200}}" height="70px" alt=""></a>
            </div>

            <div class="media-body display-1 p-2">
                <h2>Gun ID : {{ gun.gunid }}
                {% if user_data.user.user_id == gun.user_id %} 

                {% else %}
                    <small class="text-muted float-right align-middle"> Read-only </small>
                {% endif %}
                </h2>
            </div>
        </div>
    <div class="row  p-3 mb-3 bg-ur">
    <div class="mx-auto d-block">
        <ul class="nav nav-tabs bg-ur" data-toggle="" title="">
            <li class="nav-item">
                <a class="nav-link text-center list-group-item-action active" id="list-bronze-list" data-toggle="list"  href="#list-bronze" role="tab" aria-controls="list-bronze">Observer</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-center list-group-item-action " id="list-silver-list" data-toggle="list"  href="#list-silver" role="tab" aria-controls="list-silver">Recorder</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-center list-group-item-action " id="list-gold-list" data-toggle="list"  href="#list-gold" role="tab" aria-controls="list-gold">Surveyor</a>
            </li>
        </ul>
    </div>
    </div>
    <div class="tab-content" id="nav-tabContent">
        <div class='tab-pane fade show active' id="list-bronze" role="tabpanel" aria-labelledby='list-bronze-list'>
            <div class="row">
                    <div class="col-md-6">
                        <table  class="table table-striped">
                            <thead class="thead-dark">
                            <th colspan='2' scope="row">Basic Information</th>
                            </thead>
                            <tbody>
                            <tr>
                                <td>Material</td>
                                <td> <select class="custom-select" name="type">
                                    {% for name,member in gun.Types.__members__.items() %}
                                      <option value="{{name}}" {% if gun.type.value == member.value %} selected {% endif %} >{{gun_types[member.value]}}</option>
                                    {% endfor %}
                                     </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Short Desc</td>
                                <td><input class="form-control" type="text" name="description" value="{% if gun.description%}{{ gun.description }}{%endif%}" placeholder="Description" > </td>
                            </tr>
                            <tr>
                                <td>Author</td>
                                <td><input class="form-control" type="text" name="name" value="{{ user_name }}" placeholder="Name" readonly ></td>
                            </tr>
                            <tr>
                                <td>Date Recorded</td>
                                <td class="">{{gun.date.strftime('%d %b %Y')}}</td>
                            </tr>
                            </tbody>
                        </table>
                        <table class="table table-striped">
                            <tbody>
                            <tr>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" name="markings" class="custom-control-input update-field" id="markings" {% if gun.markings %} checked {% endif %} onchange="select_button('markings')" >
                                        <label class="custom-control-label" for="markings">Markings?</label>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" name="interpretation" class="custom-control-input update-field" id="inter" {% if gun.interpretation %} checked {% endif %} onchange="select_button('inter')" >
                                            <label class="custom-control-label" for="inter">Information board?</label>
                                        </div>
                                    </div>
                                </div>
                            </tr>
                            </tbody>
                        </table>
                        <table class="table table-striped">
                            </tr>
                                <tr class="hidden markings" >
                                    <td>
                                        Describe the Markings
                                    </td>
                                    <td>
                                        <input class="form-control" type="text" name="mark_details" value="{%if gun.mark_details %} {{gun.mark_details}} {% endif %}" placeholder="Details">
                                    </td>
                                </tr>
                                <tr class="hidden inter" >
                                    <td>
                                        What does the board say?
                                    </td>
                                    <td>
                                        <input class="form-control" type="text" name="inter_details" value="{%if gun.inter_details%}{{gun.inter_details}}{%endif%}" placeholder="Details">
                                    </td>
                                </tr>
                        </table>
                    </div><!-- end grid -->
                    <div class="col-md-6">
                        <table  class="table table-striped">
                            <thead class="thead-dark">
                            <th colspan='2' scope="row">Context</th>
                            </thead>
                            <tr>
                                <td>Description of Location</td>
                                <td><input class="form-control" type="text" name="context" value="{%if gun.context%}{{gun.context}}{%endif%}" placeholder="Describe context"></td>
                            </tr>
                            <tr>
                                <td>Site Name</td>
                                <td><input class="form-control" type="text" name="site" value="{%if gun.site%}{{gun.site}}{%endif%}" placeholder="Site name"></td>
                            </tr>
                            <tr>
                                <td>Museum / Collection</td>
                                <td>
                                    <div class="custom-control custom-switch">
                                            <input type="checkbox" name="collection" class="custom-control-input update-field" id="collection" {% if gun.collection %} checked {% endif %} onchange="select_button('collection')" >
                                            <label class="custom-control-label" for="collection">In a Museum / Collection?</label>
                                        </div>
                                </td>
                            </tr>
                            <tr class="hidden collection">
                                <td>Collection Name</td>
                                <td><input class="form-control" type="text" name="coll_name" value="{%if gun.coll_name %}{{gun.coll_name}}{%endif%}" placeholder="Collection name"></td>

                            </tr>
                            <tr class="hidden collection">
                                <td>Collection Ref</td>
                                <td><input class="form-control" type="text" name="coll_ref" value="{%if gun.coll_ref%}{{gun.coll_ref}}{%endif%}" placeholder="Collection reference"></td>
                            </tr>
                        </tbody></table>
                    </div>
            </div>
        
        
    <div class="row bg-light pt-3">
            <div class="col-md-6">
                <h3 class="bold">Location</h3>
                <div id="map_canvas" class="map-container inline" > </div>
                <script>
                    window.initMap = function () {
                        map_icons = {
                                'BRONZE': "/img/cannon_bronze.png",
                                'GOLD': "/img/cannon_gold.png",
                                'SILVER': "/img/cannon_silver.png"
                            };

                        marker_quality = "{{gun.quality.name}}"

                        let location = {
                            lat: parseFloat($('#lat').val()),
                            lng: parseFloat($('#lon').val())
                        };
                        map = new google.maps.Map(document.getElementById('map_canvas'), {
                            zoom: 12,
                            center: location,
                            mapTypeId: google.maps.MapTypeId.ROADMAP,
                            zoomControl: true,
                            mapTypeControl: false,
                            scaleControl: true,
                            streetViewControl: false,
                            rotateControl: true,
                            fullscreenControl: true
                        });
                        marker = null;
                        reset_map()
                    };
                </script>

                <div class="row">
                    <div class="col-4">
                        <div class="custom-control custom-radio">
                            <input type="radio" name="geolocation" class="custom-control-input" id="latlon" checked onchange="radio_button('geolocation','latlon')" >
                            <label class="custom-control-label" for="latlon">Lat/Lon</label>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="custom-control custom-radio">
                            <input type="radio" name="geolocation" class="custom-control-input" id="bng"  onchange="LL_convert('#bronze')" >
                            <label class="custom-control-label" for="bng">Grid Ref</label>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="custom-control custom-radio">
                            <input type="radio" name="geolocation" class="custom-control-input" id="locate"  onchange="radio_button('geolocation',  'locate')" >
                            <label class="custom-control-label" for="locate">Device Location</label>
                        </div>
                    </div>
                </div>



                <div class="row latlon">
                    <div class="col-md-2">
                        Lat
                    </div> <div class="col-md-3">
                        <input class="form-control" type="text" id="lat" name="lat" value="{{ gun.location.latitude }}" >
                    </div> <div class="col-md-2">
                        Long
                    </div> <div class="col-md-3">
                        <input class="form-control" type="text" id="lon" name="lon" value="{{ gun.location.longitude }}" >
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary" type="button" onclick="reset_map()">Map</button>
                    </div>
                </div>
                <div class="row latlon">
                    <small class="text-muted mx-auto">All Lat/lon coordinates must be in WGS84</small>
                </div>
                <div class="row bng">
                    <div class="col-md-2">
                        East
                    </div>
                    <div class="col-md-3">
                        <input class="form-control" type="text" name="eastings" id="eastings" value="" >
                    </div>
                    <div class="col-md-2">
                        North
                    </div>
                    <div class="col-md-3">
                        <input class="form-control" type="text" name="northings" id="northings" value="">
                   </div>
                    <div class="col-md-2">
                        <button class="btn btn-small btn-primary" type="button" onclick="BNG_convert('bronze')">Map</button>
                    </div>
                </div>
                <div class="row bng">
                    <small class="text-muted mx-auto">Conversion provided by British Geological Survey <a href="https://www.bgs.ac.uk/data/webservices/convertForm.cfm#bngToLatLng">link</a></small>
                </div>
                <div class="row locate">
                    <button class="btn btn-primary mx-auto d-block" type="button" onclick="getLocation()">Current Location</button>
                </div>

            </div>
            <div class="col-md-6">
            <div class="row"><div class="col-3">
                <h3 class="bold">Photos</h3></div>
                <div class=col-9>
                <div class="progress hidden" >
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                </div></div><div class="row">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <button type="button" class="btn btn-primary" id="inputGroupFileAddon01" >Upload</span>
                    </div>
                    
                <div class="custom-file">
                    <input type="file" multiple accept="image/*" class="custom-file-input" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01">
                    <label class="custom-file-label text-truncate" for="inputGroupFile01">Choose file</label>
                </div>
            </div>
            </div>
            <div class="" id="imgs">
            </div>
        </div>
        </div>
    </div>    
    <div div class='tab-pane fade' id="list-silver" role="tabpanel" aria-labelledby='list-silver-list'>
            <div class="position-relative">
            <div class="embed-responsive embed-responsive-16by9">
                <object class="embed-responsive-item" id="cannon" data='/img/cannon_chart.svg' type="image/svg+xml"></object>
           </div>
            
            <div class="overlap" >
            <table  class="table table-sm table-dark table-striped">
                <thead class="thead-dark">
                    <th scope="row">Measurements</th>
                    <th scope="row"><div class="row">
                        <div class="col-6 text-right">meters </div><div class="col-6 custom-control custom-switch">
                        <input type="checkbox" name="unites" class="custom-control-input update-field" id="units" checked >
                        <label class="custom-control-label" for="units">mm</label>
                    </div></div></th>
                </thead>
                <tbody class="small">
                <tr>
                    <td >Length</td>
                    <td><input class="form-control-sm" type="text" name="length" value="{{gun.measurements.length}}" placeholder="Length"></td>
                    </tr>
                    <tr>
                    <td>Base Ring Diameter</td>
                    <td><input class="form-control-sm" type="text" name="base_ring" value="{{gun.measurements.base_ring}}" placeholder="Base Ring"></td>
                    </tr>
                    <tr>
                    <td>Muzzle Diameter</td>
                    <td><input class="form-control-sm" type="text" name="muzzle" value="{{gun.measurements.muzzle}}" placeholder="Muzzle"></td>
                    </tr>
                    <tr>
                    <td>Bore Diameter</td>
                    <td><input class="form-control-sm" type="text" name="bore" value="{{gun.measurements.bore}}" placeholder="Bore"></td>
                    </tr>
                    <tr>
                    <td>Trunnion Position</td>
                    <td><input class="form-control-sm" type="text" name="trunnion_position" value="{{gun.measurements.trunnion_position}}" placeholder="Trunnion to BR"></td>
                    </tr>
                    <tr>
                    <td>Trunnion Width</td>
                    <td><input class="form-control-sm" type="text" name="trunnion_width" value="{{gun.measurements.trunnion_width}}" placeholder="Trunnion Width"></td>
                    </tr>
                    <tr>
                    <td>Trunnion Diameter</td>
                    <td><input class="form-control-sm" type="text" name="trunnion_diameter" value="{{gun.measurements.trunnion_diameter}}" placeholder="Trunnion Dia"></td>
                    </tr>
                    <tr>
                    <td>Trunnion Offset</td>
                    <td><input class="form-control-sm" type="text" name="trunnion_offset" value="{{gun.measurements.trunnion_offset}}" placeholder="Trunnion Offset"></td>
                    </tr>
                </tbody>
                </table>
            </div>
            </div>
           
        </div>
    <div div class='tab-pane fade' id="list-gold" role="tabpanel" aria-labelledby='list-gold-list'>
            <>td style="position: static">
               <select class="custom-select" name="quality">
               {% for name,member in qualities.__members__.items() %}
                    <option value="{{name}}" {% if member.value == gun.quality.value %} selected {% endif %} >{{qualities_text[member.value]}}</option>
               {% endfor %}
               </select>
           </td>
        </div>
</form>



{% endblock %}

{% block script %}

<script src="/static/sweetalert.min.js"></script>
<script src="/static/markerclusterer.js"></script>
<script async defer src="//maps.googleapis.com/maps/api/js?key=AIzaSyAjR85QEAekYmsSyDPETXxprFpnEsdgjjU&amp;callback=initMap"></script>
<script type="application/javascript" >
                    let edit = "{{edit}}";
                    $('.bng').hide();
                    $('.locate').hide();
                    if (edit === "True") {
                        $('#top-button').html(
                            '<ul class="nav-bar nav px-1"><Button type="submit" form="bronze" class="btn btn-primary"  href="#">Save</Button></ul>' + $('#top-button').html()
                        )
                        $('#inputGroupFileAddon01').click(function(){send_file()})
                        }
                    else {
                        $('input').prop("readonly", true);
                        $('select').prop("disabled", true);

                    }
                    $('#imgs').imagesGrid({
                        images: [ {% for image in images %}{src:"{{image.original|safe}}", thumbnail: "{{image.s200|safe}}" },{% endfor %} ],
                        cells: 4,
                        align: true,
                        showViewAl: "always"
                    });
                    $(function(){
                        let cannon = $("#cannon")[0];
                        cannon.addEventListener('load', function() {
                        let cannonSvg = cannon.contentDocument;
                        cannonSvg.getElementById('length-text').firstElementChild.innerHTML = "{{gun.measurements.length}}";
                        cannonSvg.getElementById('br-text').firstElementChild.innerHTML = "{{gun.measurements.base_ring}}";
                        cannonSvg.getElementById('muzzle-text').firstElementChild.innerHTML = "{{gun.measurements.muzzle}}";
                        cannonSvg.getElementById('bore-text').firstElementChild.innerHTML = "{{gun.measurements.bore}}";
                        cannonSvg.getElementById('tp-text').firstElementChild.innerHTML = "{{gun.measurements.trunnion_position}}";
                        cannonSvg.getElementById('tw-text').firstElementChild.innerHTML = "{{gun.measurements.trunnion_width}}";
                        cannonSvg.getElementById('td-text').firstElementChild.innerHTML = "{{gun.measurements.trunnion_diameter}}";
                        cannonSvg.getElementById('to-text').firstElementChild.innerHTML = "{{gun.measurements.trunnion_offset}}";
                        });
                    })
                    
    
</script>
{% endblock %}